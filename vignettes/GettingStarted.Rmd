---
title: "Getting Started with finsyncR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options:
  markdown:
    wrap: sentence
---

```{=html}
<style>
    img {
        border: 0;
    }
</style>
```
# Introduction

United States (US) federal biomonitoring programs exist to assess the status and trends of the physical, chemical and biological condition of US waters, and collect data on freshwater communities.
These programs use standardized sampling protocols to produce data that is unparalleled in terms of spatial extent, temporal scope, and diversity of taxa surveyed.
These data are used by the US government in assessment frameworks, but a wealth of additional knowledge can be gleaned from unique applications of these data.
While most data associated with these biomonitoring efforts are publicly available, barriers remain for new, outside users to apply these data without institutional guidance.

`finsyncR` (**f**ish and **in**vertebrate **sync**hronizer in **R**) is an R package that flexibly acquires, processes, and integrates national-level aquatic biomonitoring datasets in the US, with a focus on fish and macroinvertebrates in rivers and streams.
The package streamlines the process of retrieving and harmonizing these data, improving access to cleaned data, and making the application of these data straightforward for researchers.
The sources of data for this package are the United States Environmental Protection Agency's (EPA) National Aquatic Resource Surveys (NARS), namely the National River and Streams Assessment (NRSA), and United States Geological Survey's (USGS) BioData.

The package provides standardized abundance and occurrence data for fish and density and occurrence data for macroinvertebrates at a variety of levels of taxonomic resolution.

The package provides flexibility for common data integration and processing issues for temporal biologic datasets.
The package can also match sampling sites to land cover data.
The goals of the package are to: 1) unify EPA NRSA and USGS BioData creating a single national-scale, long-term dataset for fish and macroinvertebrates, 2) to streamline the process of acquiring, processing, and integrating these data, 3) to increase access to cleaned data and make the application of these data straightforward for users, and 4) to help users forgo common issues in data management by documenting the barriers to data use and by providing flexible strategies to overcome these barriers.
These barriers include understanding spatial sampling designs and sampling frequencies, processing and integrating datasets across years and federal agencies, accounting for differences in taxonomy between agencies and through time, calculating densities and standardized abundances from field counts of organisms, accounting for differences in sampling effort across sampling events, and accounting for improvements in taxonomic identifications through time.
In this Getting Started Vignette, we document barriers and strategies to overcome them, so users can make informed decisions about the data given their specific research questions.
Potential future uses of the data include studies of changes in fish and macroinvertebrate communities across space and time and the environmental causes and ecological consequences of those changes (see [Table 1](#Table1)).

While this vignette is a how-to guide for using the package, a manuscript describing the motivations of the package within a broad framework and the methods for the construction of the package is currently in submission.

An abbreviated [summary](#TL;DR) of the benefits, barriers addressed, and caveats presented both here and in the manuscript can be found at the end of this vignette.

<br> <a id="Table1"></a> **Table 1.** Example code to generate macroinvertebrates and fish datasets given hypothetical research questions.

| Research question                                                                                                            | Output dataset requested                                                                                                                               |                                                                                                                                                                                                                                                                         Macroinvertebrates |                                                                                                                                                                                                                        Fish |
|:-----------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| How does density/CPUE change through time across EPA and USGS samples?                                                       | Density/CPUE at sites for lowest taxonomic resolution, with shared taxa only, removing hybrid fish, and excluding boatable streams/rivers              |                                  `getInvertData(dataType = "density",` <br> `taxonLevel = "Genus",` <br> `taxonFix = "lump",` <br> `agency = c("USGS","EPA"),` <br> `lifestage = FALSE,` <br> `rarefy = FALSE,` <br> `sharedTaxa = TRUE,` <br> `seed = 0,` <br> `boatableStreams = FALSE)` |          `getFishData(dataType = "density",` <br> `taxonLevel = "Species",` <br> `agency = c("USGS","EPA"),` <br> `standardize = "CPUE",` <br> `hybrids = FALSE,` <br> `sharedTaxa = TRUE,` <br> `boatableStreams = FALSE)` |
| How does the composition of families differ between EPA and USGS samples?                                                    | Occurrence at sites for Family resolution, with all taxa, rarefying macroinvertebrate counts to 300 individuals, and excluding boatable streams/rivers |          `getInvertData(dataType = "occur",` <br> `taxonLevel = "Family",` <br> `taxonFix = "none",` <br> `agency = c("USGS","EPA"),` <br> `lifestage = FALSE,` <br> `rarefy = TRUE,`<br> `rarefyCount = 300,` <br> `sharedTaxa = FALSE,` <br> `seed = 1,` <br> `boatableStreams = FALSE)` |                                    `getFishData(dataType = "occur",` <br> `taxonLevel = "Family",` <br> `agency = c("USGS","EPA"),` <br> `standardize = "none",` <br> `sharedTaxa = FALSE,` <br> `boatableStreams = FALSE)` |
| What are spatial occupancy patterns within the Upper-Midwest Ecoregion using the randomized sampling design of the EPA NARS? | Occurrence for lowest taxonomic resolution for only EPA samples, then filtered to the UWM Ecoregion                                                    | `getInvertData(dataType = "occur",` <br> `taxonLevel = "Family",` <br> `taxonFix = "none",` <br> `agency = c("EPA"),` <br> `rarefy = TRUE,`<br> `rarefyCount = 500,` <br> `sharedTaxa = FALSE,` <br> `seed = 1,` <br> `boatableStreams = TRUE) %>%` <br> `filter(NARS_Ecoregion == "UMW")` | `getFishData(dataType = "occur",` <br> `taxonLevel = "Family",` <br> `agency = c("EPA"),` <br> `standardize = "none",` <br> `sharedTaxa = FALSE,` <br> `boatableStreams = TRUE) %>%` <br> `filter(NARS_Ecoregion == "UMW")` |

<br>

Data from USGS BioData were obtained from Pete Ruhl ([pmruhl\@usgs.gov](mailto:pmruhl@usgs.gov){.email}) and are stored internally, and data from the National Aquatic Resource Surveys are directly downloaded by the package from the website: <https://www.epa.gov/national-aquatic-resource-surveys/data-national-aquatic-resource-surveys>.


```r
library(devtools)
##install the finsyncR package
devtools::install_github("USEPA/finsyncR",
                         build_vignette = TRUE)
```


```r
##Read in the finsyncR package
library(finsyncR)
```

<br>

# Biotic Datasets

The package is organized into two groups of functions, namely functions that assemble biotic and abiotic datasets.
Two functions generate biotic datasets: `getInvertData()` and `getFishData()`, which generate community matrices for macroinvertebrates and fish, respectively.
The data management workflow for these functions generally follows three major steps: acquiring data and initial formatting, processing data separately by agency, and finally integrating data between EPA and USGS sources ([Figure 1](#Figure1)).

<br>

<center>

<a id="Figure1"></a>

![**Figure 1**. Workflow diagram of the simplified data management steps used in the construction of community matrices for macroinvertebrates, `getInvertData()`, and fish, `getFishData()`. Function parameters specified in each step of data management are provided. The metadata for the output datasets with definitions for variables included in this workflow cna be accessed within the package using `vignettes("Metadata", "finsyncR")`.](https://github.com/mahonmb/Misc/blob/main/WorkFlow.png?raw=TRUE){width="700"}

</center>

<br>

## Macroinvertebrates

`getInvertData()` retrieves, cleans, and compiles the stream macroinvertebrate datasets collected by the USGS and EPA.
The function harmonizes taxonomy of macroinvertebrates across agencies and through time.
In addition, it accounts for differences in sample splitting, which vary by agency.
The parameters in the `getInvertData()` function are `dataType`, `taxonLevel`, `taxonFix`, `agency`, `lifestage`, `rarefy`, `rarefyCount`, `sharedTaxa`, `seed` and `boatableStreams.` `dataType` refers to whether the sample by taxa community matrix contains density (`dataType = "density"`) or occurrence (`dataType = "occur"`) values.
Density values are number of organisms per m^2^ and occurrence values are presence (1) or absence (0).

`taxonLevel` refers to the taxonomic resolution (Genus, Class, Family, etc.) for the sample by taxa matrix.
The input values for this parameter are case sensitive and must start with a capital letter.
All observations taxonomically coarser than the `taxonLevel` provided are dropped from the output community matrix.
For instance, if `taxonLevel = "Genus"` , then observations identified at Subfamily, Family, Order, Class, or Phylum levels are dropped.
When `taxonLevel = "Subfamily"`, for taxa without subfamilies, the Family-level designation is returned.
The function also provides for the option of returning the lowest level of taxonomic identification for all specimen (`taxonLevel = "Mixed"`).
"Genus" is the finest level of taxonomic resolution provided for macroinvertebrates.
The package does not provide USGS species-level identifications for two reasons.
First, we limit USGS identification to the genus-level to make the EPA and USGS data comparable.
Second, species-level identifications of some groups of macroinvertebrates are inherently difficult to make, so we limit identifications to the genus-level to avoid potentially inaccurate identifications.

Across the time span of the USGS and EPA macroinvertebrate datasets, the taxonomy of many macroinvertebrates changed, specifically membership of species within genera.
`taxonFix` provides options to harmonize taxonomy through time, especially in instances in which membership of a given organism within a genus is not clear.
In certain scenarios a given organism may have been identified to genus at the lab bench, yet when taxonomic updates occurred, only some species within the originally designated genus moved to a different genus.
This scenario prevents confident identification of a given organism's "true" genus because it is possible the organism in question might belong to the original genus or the new, updated genus.
For instance, consider an organism identified with the hypothetical genus *Hereiam*.
At the time of the identification, there were only two species within this genus: *Hereiam here* and *Hereiam there*.
In the time since the identification in the lab, the taxonomy has been reorganized, and presently the genus *Hereiam* only contains one species *Hereiam here*, and a new genus has been created.
*Hereiam there* is now *Thereiam there*.
So, it is unclear whether the organism, originally identified as *Hereiam* belongs to *Hereiam* or *Thereiam* because of the updates in taxonomy.
This issue is especially difficult to overcome when attempting to harmonize samples that were identified before and after a taxonomic update occurred.

The package provides three options for accounting for these changes in taxonomy through time using the parameter `taxonFix`.
First, the default option `taxonFix = "lump"` creates complexes of genera, hereafter termed "lump genera", by combining all possible genera for the given organism.
This approach prioritizes retaining observations of organisms by giving a unified name (e.g. genus1/genus2/genus3) to a complex of genera that have been linked through changes in taxonomy through time.
With this approach, there is no temporal increase or decrease in the number of genera, given that individual genera (e.g. genus1) never appear outside of the lumped genera name (e.g. genus1/genus2/genus3).
Thus, in the hypothetical example above, *Hereiam* and *Thereiam* would occur as "*Hereiam/Thereiam*" throughout the generated dataset.
In total, 82 genera are linked by changes in taxonomy through time ([Figure 2](#Figure2)).
The "lump" approach described above reduces these 82 genera to 11 lump genera.
All but three lumped genera were composed of two individual genera.
A single lump genera group within the order Ephemeroptera includes 54 genera, and two additional lump genera groups of Ephemeroptera genera include six genera each.
Because of the complexity of Ephemeroptera taxonomy, careful consideration should be given to inferences that can be made when evaluating Ephemeroptera trends.
The authors, for instance, do not advise users evaluate temporal changes in density or richness of the linked groups of Ephemeroptera genera because taxonomic reorganizations over the last decades likely obscure temporal patterns.

<br>

<center>

<a id="Figure2"></a>

![**Figure 2.** Visualization of the relationships among genera linked by taxonomic reorganization through time. Each numbered circle represents an individual genus. Lines between genera pairs indicate that the taxonomic designation of at least one species from one of the genus pairs was updated to be in the other genus in the pair. Clusters (lump genera) are formed by sets of these linked genera. See [Appendix Table A1](#TableA1) for table linking numbers in the above cluster to genera names.](https://github.com/mahonmb/Misc/blob/main/GenusClusters.jpg?raw=true){width="350"}

</center>

<br>

The second option, `taxonFix = "remove"`, prioritizes accurate identification by dropping observations that cannot be confidently identified to a single genus, which includes the complexes of genera previously described.
In addition, `taxonFix = "remove"` also removes organisms identified as slash genera (e.g. Cricotopus/Orthocladius), which are identifications given to organisms during identification when multiple genera cannot be distinguished according to an identification key.
So, `taxonFix = "remove"` results in a dataset that has fewer genera compared to a dataset generated with `taxonFix = "lump"`.
`taxonFix = "remove"` is the best option if accurate identification is a high priority for users.

Finally, `taxonFix = "none"` makes no adjustment and returns identifications in their original forms.
The `taxonFix = "none"` option generates slash genera for organisms that are given a slash genus either at the time of identification or to harmonize occurrences of slash genera between USGS and EPA observations, as described above.

`taxonFix` operates on the genus level, so `taxonFix` must be set to `"none"` when `taxonLevel` is set to "Subfamily" or higher taxonomic resolution.
Care should be taken to harmonize taxonomy either with the approaches provided or some alternative when long time scale datasets on the entire community of macroinvertebrates are generated because changes in taxonomy can make it artificially appear as though some genera are either appearing or disappearing in time.

No matter the value provided to `taxonFix`, taxonomy is harmonized in three additional ways to appropriately join USGS and EPA datasets.
First, in instances when a given organism has been identified at the species level and the genus that was given at the time of identification has been updated to a new genus, the package updates the genus by cross walking the bench identification to the current genus (*Hereiam there* becomes *Thereiam there* from the previous example).
Second, there are instances when a slash genus was not used consistently between USGS and EPA.
As a hypothetical example, the USGS data contains an organism identified as genus1/genus2, while EPA data included separate identifications of genus1 and genus2.
To ensure consistency between the agencies, the package renames all single instances of genus1 and genus2 to genus1/genus2 when combining the EPA and USGS samples into a single dataset.
Third, within the EPA dataset, a group of chironomids were identified to a genus-group (*Thienemannimyia* genus group), which consists of the chironomid genera *Arctopelopia*, *Conchapelopia*, *Hayesomyia*, *Helopelopia*, *Meropelopia*, *Rheopelopia*, *Telopelopia*, and *Thienemannimyia.* The package replaces instances of organisms identified to one of these individual genera or the *Thienemannimyia* genus group with a single slash genus, *Arctopelopia/Conchapelopia/Hayesomyia/Helopelopia/Meropelopia/Rheopelopia/Telopelopia/Thienemannimyia*.
The taxonomy dataset used to harmonize was provided by USGS BioData.

`agency` refers to the agency that collected the data.
The default is `c("USGS", "EPA")` and results in the largest dataset.
Users should be aware that the sampling designs (strategies for selecting sampling locations) from each agency are quite different ([Figure 3](#Figure3)).

<br>

<center>

<a id="Figure3"></a>

![**Figure 3.** EPA and USGS sampling locations through years for both fish and macroinvertebrates. Sampling locations for USGS are set by research priorities of a given time period and those priorities change through time. The USGS sampling design results in a clustered pattern in some early years, and in later years, sites are more dispersed across the US. WSA, which is part of NRSA from 2000-2004, used a randomized sampling design but surveyed only wadeable streams in either eastern or western portions of the US in each year. In subsequent rounds of NRSA, a randomized sampling strategy is used across the entirety of the US and included both wadeable and boatable waterbodies, resulting in data that is representative of rivers and streams across the contiguous US.](https://github.com/mahonmb/Misc/blob/main/sitesthrutime.png?raw=TRUE){width="550"}

</center>

<br>

Sampling locations for USGS are set by research priorities of a given time period and assessment, and those priorities change through time.
The BioData sampling design results in a clustered pattern in some early years, and in later years, sites are more dispersed throughout the US ([Figure 3](#Figure3)).
Conversely, EPA NARS uses a spatially balanced randomized sampling design to ensure that data collected are representative of water bodies across the contiguous US.
The surveys of rivers and streams is called the National Rivers and Streams Assessment (NRSA).
EPA sampling efforts are generally two years in length with four years in between each effort ([Figure 3](#Figure3)).
An exception is an early iteration of NRSA called the Wadeable Streams Assessment (WSA).
From 2000 to 2004, WSA surveyed only wadeable streams in either eastern or western portions of the US in each year.
For more information see the sampling manuals from the agencies: [USGS NAWQA](https://pubs.usgs.gov/publication/ofr93406) and [EPA NRSA](https://www.epa.gov/national-aquatic-resource-surveys/manuals-used-national-aquatic-resource-surveys#National%20Rivers%20&%20Streams%20Assessment). Most sites across both EPA and USGS are sampled for a single year, although subsets of sites within each agency have been resampled across years ([Figure 4](#Figure4)).

<br>

<center>

<a id="Figure4"></a>

![**Figure 4.** Histograms showing the distributions in the number of unique years sites were sampled for macroinvertebrates and fish by the EPA and USGS. The vast majority of sites are sampled once. There are 60 sites with macroinvertebrates sampled in 10 or more years and 76 sites with fish sampled in 10 or more years from the USGS.](https://github.com/mahonmb/Misc/blob/main/TimesSampledBoth.png?raw=TRUE){width="500"}

</center>

<br>

About 10% of EPA sites are resampled within a sampling round (e.g. 2008/2009), and about 40-50% of sites are resampled across consecutive sampling rounds (e.g. 2008/2009 to 2013/2014).
However, the sites that are resampled between each set of consecutive rounds are not the same, so the 40-50% of 2008/2009 sites resampled in 2013/2014 are not the same 40-50% of 2013/2014 sites resampled in 2018/2019.
EPA site names have been harmonized so that sites sampled in more than one year have the same name.
The strength of the data in this package is its spatial coverage and extent, not the average number of times individual sites were sampled through time.

`boatableStreams` provides the option to include data from large streams and rivers that are too deep to be sampled by wading along with wadeable streams.
All USGS macroinvertebrate sampling locations are considered wadeable streams, while EPA samples both wadeable streams and boatable rivers.
As such, `boatableStreams` should only be `TRUE` when `agency` is set to `"EPA"` only, to ensure the highest comparability between the two agency datasets.

`rarefy` provides an option to randomly subsample samples to a user defined number of individuals.
The target number of organisms identified within a sample varies across programs, agencies, time, and space, which introduces variation in output datasets.
Target counts are typically 500 individuals for EPA samples, and they range from 100-600 for USGS samples.
This parameter can be used to account for differences in the number of individuals sampled, which can be useful in the calculation of diversity metrics.
When `rarefy = TRUE`, only samples containing at least `rarefyCount` individuals are retained.
The rarefaction level defaults to 300 individuals, `rarefyCount = 300`, to balance the proportion of the samples dropped that failed to meet the rarefaction level with the addition of genera gained at the rarefaction level ([Figure 5](#Figure5)).
All samples with \<300 individuals sampled are removed from the output dataset.
With a rarefaction level of 300, \~91% of all samples are retained, and with every 50 individuals identified, \~1 genus is added to the average sample.
So, lowering the threshold to 200 individuals would have removed \~2 genera per sample and would have retained 94.5% of all samples.
Similarly, increasing the threshold to 400 individuals would have added \~2 genera per sample but would have retained only 70.6% of all samples.

<br>

<center>

<a id="Figure5"></a>

![**Figure 5.** Visualization of the relationship between mean number of genera gained, the proportion of samples with at least n number of organisms identified, and the number of organisms identified per sample in all streams, justifying the use of 300 as the default rarefication threshold.](https://github.com/mahonmb/Misc/blob/main/invertRare.png?raw=TRUE){width="350"}

</center>

<br>

Use `seed =` and provide an integer to consistently generate output from the function.
This parameter is passed to `set.seed()` internally.
When generating density values, use `dataType = "density"` and `rarefy = FALSE` (default).

`lifestage` refers to whether the generated site by taxa matrix should include lifestage information for each organism.
If `lifestage = TRUE`, the generated matrix will have separate columns for the various lifestages collected for each taxon.
Lifestage is only provided for the USGS samples.

`sharedTaxa` refers to whether the resulting dataset should retain only taxa that are found by both agencies.
Set `sharedTaxa = FALSE` when generating a dataset for only one agency.
We recommend using `sharedTaxa = TRUE` for building a dataset with both agencies, so that species pools are consistent.


```r
##This code will generate density estimates at the Genus level for all samples
##in USGS BioData. Lifestage information will be ignored.

Inverts <- getInvertData(dataType = "density",
                         taxonLevel = "Genus",
                         agency = "USGS",
                         lifestage = FALSE,
                         rarefy = FALSE,
                         boatableStreams = FALSE)
```

```r
head(Inverts)[,1:25]
```

```
##   Agency      SampleID ProjectLabel           SiteNumber
## 1   USGS BDB-000025076  WHMI BioTDB USGS-393259085101200
## 2   USGS BDB-000025078  WHMI BioTDB        USGS-03245500
## 3   USGS BDB-000025080  WHMI BioTDB        USGS-03246400
## 4   USGS BDB-000025082  WHMI BioTDB USGS-395534084091400
## 5   USGS BDB-000025084  WHMI BioTDB USGS-395650083504400
## 6   USGS BDB-000025126  WHMI BioTDB USGS-392246084340100
##                   StudyReachName CollectionDate CollectionYear CollectionMonth
## 1 393259085101200-A-NAWQA-BioTDB     1999-07-13           1999               7
## 2        03245500-A-NAWQA-BioTDB     1999-07-14           1999               7
## 3        03246400-A-NAWQA-BioTDB     1999-07-15           1999               7
## 4 395534084091400-A-NAWQA-BioTDB     1999-07-07           1999               7
## 5 395650083504400-A-NAWQA-BioTDB     1999-07-06           1999               7
## 6 392246084340100-A-NAWQA-BioTDB     1999-07-13           1999               7
##   CollectionDayOfYear Latitude_dd Longitude_dd CoordinateDatum    COMID
## 1                 194    39.54977    -85.16996           NAD27  3923217
## 2                 195    39.17145    -84.29799           NAD27 25243939
## 3                 196    39.05895    -84.05132           NAD27  3936150
## 4                 188    39.92617    -84.15383           NAD27  3985952
## 5                 187    39.94728    -83.84549           NAD27  3985520
## 6                 194    39.37950    -84.56689           NAD27  3885882
##   StreamOrder WettedWidth PredictedWettedWidth_m NARS_Ecoregion SampleTypeCode
## 1           4          NA                  27.88            SAP           IRTH
## 2           5          NA                  43.55            TPL           IRTH
## 3           4          NA                     NA            TPL           IRTH
## 4           5          NA                  46.70            TPL           IRTH
## 5           5          NA                  28.50            TPL           IRTH
## 6           7          NA                 100.42            TPL           IRTH
##   AreaSampTot_m2 FieldSplitRatio LabSubsamplingRatio PropID Gen_ID_Prop
## 1           1.25               1              0.0170 0.0170   0.8838527
## 2           1.25               1              0.0347 0.0347   0.8655914
## 3           1.25               1              0.0397 0.0397   0.8084416
## 4           1.25               1              0.0149 0.0149   0.7481297
## 5           1.25               1              0.0298 0.0298   0.7476923
## 6           1.25               1              0.0113 0.0113   0.8468208
##   Acentrella.Acerpenna.Amercaenis....[TRUNCATED]   Antocha
## 1    3104.8                                           94.4
## 2    1497.6                                            0.0
## 3    2217.6                                            0.0
## 4    2365.6                                           53.6
## 5    1263.2                                            0.0
## 6    1058.4                                            0.0
```

<br>

Macroinvertebrate community matrices generated with `taxonLevel = "Mixed"` and `taxonFix = "lump"` can be further processed by the function `lumpRollUp()`.
The function rolls lump genera to the lowest common taxonomic designation ([Appendix Table A1](#TableA1); e.g., Elimia/Pleurocera to Pleuroceridae).
The function then sums occurrence or density data within duplicate broader taxonomic designations (occurrences summed then converted to 0/1).
This function does not adjust slash taxa (those organisms that were identified to a slash genus designation in the lab).
The input parameter to the function is a dataset generated by `getInvertData(taxonLevel = "Mixed", taxonFix = "lump")`.

### Using the macroinvertebrate data

Alongside community matrices, `getInvertData()` provides covariate data that describes details of sampling methods.
Two covariates, proportion of sample identified (`PropID`) and area sampled (`AreaSampledTotal_m`), are of particular interest because they are used to calculate densities of macroinvertebrates ([Figure 6](#Figure6)) and represent different facets of sampling effort.

<br>

<center>

<a id="Figure6"></a>

![**Figure 6**.Calculation of sample densities for USGS and EPA samples. The field split ratio is the proportion of the field collected sample that is brought into the lab to be identified. Note that only the USGS data included field split ratios. Lab subsampling ratio is the proportion of grids in a subsampling tray used to identify and enumerate macroinvertebrates in the lab.](https://github.com/mahonmb/Misc/blob/main/InvertAbun.png?raw=TRUE){width="525"}

</center>

<br>

For macroinvertebrates, density calculations are simply macroinvertebrate abundance divided by the area sampled ([Figure 6](#Figure6)).
Macroinvertebrate abundance is the number of individuals counted in a gridded tray in the lab multiplied by the inverse of the proportion of the sample collected in the field that was identified at the lab bench (`PropID`).
The calculation of `PropID` differs by agency because of differences in splitting samples in the field.
For USGS samples, a proportion of the homogenized field sample is separated before specimen identification and enumeration in the lab.
This proportion is the "field split ratio" ([Figure 6](#Figure6)).
EPA field samples are not split.
For both EPA and USGS the processing of samples in the lab is similar.
In the lab, organisms in a sample are placed uniformly among the grids in a subsampling tray.
Grids are randomly selected and organisms within a given grid are identified until a target organism count is reached.
The proportion of grids used to identify macroinvertebrates at the lab bench is the "lab subsampling ratio".
For USGS samples, `PropID` is calculated by multiplying the "field split ratio" and the "lab subsampling ratio" ([Figure 6](#Figure6)).
For EPA samples, `PropID` is equal to the "lab subsampling ratio" ([Figure 6](#Figure6)).

Sampling effort is a source of variation and should be considered in the context of research questions because sampling effort can influence sample abundances and probability of detection of any given organism.
For instance, sampling effort varies across sampling events and is also correlated with time in some cases, which could lead to biased interpretation in certain analyses.
Given that `PropID` and `AreaSampledTotal_m` are facets of sampling effort, they influence the number of individuals measured in a sample.
As `PropID` and `AreaSampledTotal_m` increase, the total density of macroinvertebrates decreases, and as time proceeds `PropID` and `AreaSampledTotal_m` increase ([Figure 7](#Figure7)).
Together, these trends suggest the potential that early years could be biased to large sample densities and later years could be biased to low sample densities, which would make it appear as though total densities decline over time.

<br>

<center>

<a id="Figure7"></a>

![**Figure 7**. Associations among sampling variables (proportion of the sample identified (`propID`) and area sampled (`AreaSampledTotal_m`), total macroinvertebrate densities within samples, and time for both EPA and USGS datasets. Trend lines are simple linear relationships between sets of variables. These associations suggest that users should carefully consider these sampling effort variables because ignoring these variables could lead to spurious results in some instances. For instance, as (A) `propID` and (B) `AreaSampledTotal_m` increase, the total density of macroinvertebrates decreases, and as time proceeds (C) `propID` and (D) `AreaSampledTotal_m` increase. Together, these trends suggest the potential that early years could be biased to high density measurements and later years could be biased to low density measurements, which would make it appear as though total densities decline over time.](https://github.com/mahonmb/Misc/blob/main/proparea.png?raw=TRUE){width="550"}

</center>

<br>

The proportion of organisms within samples identified to genus (`genPropID`) is a variable that describes potential changes in the ability of taxonomists to identify specimen through time.
Within some orders, `Gen_ID_Prop` increases over time, likely indicating that taxonomists improved in their abilities to make identifications at the genus or species level, and as a result the probability of detection of these groups would appear to increase through time ([Figure 8](#Figure8)).
Similarly, within some orders within the EPA dataset, `Gen_ID_Prop` decreases over time.
One possible explanation for these trends could be the time spent identifying and enumerating WSA samples was greater than NRSA samples, and as a result the detection of these groups could appear to decrease through time ([Figure 8](#Figure8)).
Users should take care to consider these patterns since they could lead to the false impression that genera appear and disappear through time.

<br>

<center>

<a id="Figure8"></a>

![**Figure 8**. Plots showing relationships between time and the proportion of specimens identified to genus within samples by order for EPA and USGS datasets. Trends could indicate that within a given order, the abilities to make identifications at the genus level changed across time.](https://github.com/mahonmb/Misc/blob/main/GenIDPropOrderThruTime.png?raw=TRUE){width="550"}

</center>

<br>

## Fish

`getFishData()` retrieves, cleans, and compiles the stream fish datasets collected by USGS and EPA.
Fish species names output by the function are unified and current, meaning that species that may have had multiple, synonymous names in the raw datasets have been combined and replaced with the current scientific name.

The parameters in the `getFishData()` function are `dataType`, `taxonLevel`, `agency`, `standardize`, `hybrids`, `sharedTaxa`, and `boatableStreams.` `dataType` refers to whether the sample by taxa community matrix contains abundance (`dataType = "abun"`) or occurrence (`dataType = "occur"`) values.
Abundance values are counts and occurrence values are presence (1) or absence (0).

`taxonLevel` refers to the taxonomic resolution (Species, Genus, Class, Family, etc.) for the sample by taxa matrix.
The input values for this parameter must start with a capital letter.
All observations taxonomically coarser than the taxonLevel provided are dropped from the output community matrix.
For instance, if `taxonLevel = "Genus"`, then observations identified at Family, Order, Class, or Phylum levels are dropped.
The lowest level of taxonomic identification for fish is `"Species"` because of inconsistent subspecies identifications.

`agency` refers to the agency that collected the data.
The default is c("USGS", "EPA") and results in the largest dataset.
Users should be aware that the sampling designs of each agency are quite different ([Figure 3](#Figure3)).
In addition, most sites are only sampled once ([Figure 4](#Figure4)).
For more information, see the discussion of the agency parameter for `getInvertData()`.

`standardize` refers to whether the abundance values in the community matrix should be standardized by unit effort and reach length fished to account for differences in sampling effort.
Specifically, catch per unit effort, `standardize = "CPUE"`, results in abundances that are divided by the product of sampling effort (e.g. minutes shocked, number of seine hauls, or snorkel transects) and stream length sampled ( \ref{eq: 1} ).

```{=tex}
\begin{equation}
  \tag{eq: 1}
  \label{eq: 1}
  CPUE = \frac{taxa~abundance}{(sampling~effort~*~stream~length~fished~(m))}
\end{equation}
```
To account for differences in efficacy between shocking, seining, and snorkeling, multigear mean standardization (`standardize = "MGMS"`) is another standardization method provided as an alternative to catch per unit effort (`standardize = "CPUE"`).
When `standardize = "MGMS"`, individual species abundances are standardized for each gear type (e.g., electroshock, seine net, snorkel), as above in CPUE.
Then, for each gear type, the CPUE of all *i* species in each sample *j* is summed, to get Total Catch Per Unit Effort for sample *j* (TCPUE~*j*~, \ref{eq: 2}).

```{=tex}
\begin{equation}
\tag{eq: 2}
\label{eq: 2}
TCPUE_j = \sum_{} CPUE_{ij}
\end{equation}
```
For each gear type, the mean TCPUE is then calculated.
Next, to standardize each gear, CPUE for each taxa *i* is divided by mean TCPUE (\ref{eq: 3}).

```{=tex}
\begin{equation}
\tag{eq: 3}
\label{eq: 3}
MSC_{ij} = \frac{CPUE_{ij}}{\overline{TCPUE}}
\end{equation}
```
MSC~*ij*~ is the mean standardized catch of species *i* in observation *j*.
The units of sampling effort cancel in the calculation of MSC~*ij*~.
The function then sums the MSC~*ij*~ among gear types, resulting in a single row of data for each sampling event, regardless of the number of gear types used.
See [Gibson-Reinemer et al. (2017)](https://doi.org/10.1139/cjfas-2016-0003) for more regarding the computation of MGMS.

Users should set standardize to either "`CPUE`" or "`MGMS`" if they are interested in comparing abundance values across sites.
Note: some of the samples lacked information on either stream length sampled or sampling effort.
Therefore, if a user is interested in occurrence (presence/absence) data only, then set `dataType = "occur"` and `standardize = "none"`, which provides an occurrence dataset, which contains the samples that are dropped with standardization.

`hybrid` provides the option to exclude fish identified as a hybrid of two species.
Because hybrids are difficult to identify in the field, users should keep the default setting `hybrid = FALSE` if accurate identification is important.

`sharedTaxa` refers to whether the resulting dataset should contain only taxa that are found in both agency datasets.
Set `sharedTaxa = FALSE` when building a dataset with samples collected by only one agency.
We recommend using `sharedTaxa = TRUE` when building a dataset with samples collected by both agencies, so species pools are consistent.

Finally, `boatableStreams` provides the option to include data from large streams and rivers that are too deep to sample by wading.
When `boatableStreams = TRUE`, the output dataset will include both boatable and wadeable streams and rivers.


```r
##This code will generate occurrences at the Family level for all samples
##in both the USGS and EPA databases.

Fish <- getFishData(dataType = "occur",
                    taxonLevel = "Family",
                    agency = c("USGS", "EPA"),
                    standardize = "none",
                    hybrids = FALSE,
                   boatableStreams = TRUE)
```

```r
head(Fish)[,1:28]
```

```
##   Agency      SampleID ProjectLabel    SiteNumber      StudyReachName
## 1   USGS BDB-000025003     MMSD Eco USGS-04086600 04086600-A-MMSD Eco
## 2   USGS BDB-000025011     MMSD Eco USGS-04087030 04087030-A-MMSD Eco
## 3   USGS BDB-000025015     MMSD Eco USGS-04087070 04087070-A-MMSD Eco
## 4   USGS BDB-000025019     MMSD Eco USGS-04087088 04087088-A-MMSD Eco
## 5   USGS BDB-000025023     MMSD Eco USGS-04087119 04087119-A-MMSD Eco
## 6   USGS BDB-000025034     MMSD Eco USGS-04087204 04087204-A-MMSD Eco
##   CollectionDate CollectionYear CollectionMonth CollectionDayOfYear
## 1     2007-09-10           2007               9                 253
## 2     2007-09-05           2007               9                 248
## 3     2007-09-05           2007               9                 248
## 4     2007-09-04           2007               9                 247
## 5     2007-09-12           2007               9                 255
## 6     2007-09-07           2007               9                 250
##   Latitude_dd Longitude_dd CoordinateDatum    COMID StreamOrder WettedWidth
## 1    43.28028    -87.94250           NAD83 12162572           5          NA
## 2    43.17278    -88.10389           NAD83 12163826           3          NA
## 3    43.12361    -88.04361           NAD83 12163856           3          NA
## 4    43.05472    -88.04611           NAD83 12163882           2          NA
## 5    43.04383    -88.00511           NAD83 12163888           1          NA
## 6    42.92500    -87.87000           NAD83 12168981           2          NA
##   PredictedWettedWidth_m NARS_Ecoregion SampleTypeCode FishCollection
## 1                  46.17            TPL Large Wadeable Fish Collected
## 2                   8.98            TPL Small Wadeable Fish Collected
## 3                   8.50            TPL Small Wadeable Fish Collected
## 4                   6.72            TPL Small Wadeable Fish Collected
## 5                   5.12            TPL Small Wadeable Fish Collected
## 6                   7.26            TPL Small Wadeable Fish Collected
##   ReachLengthFished_m SampleMethod MethodEffort MethodEffort_units
## 1                 300        Seine            3    Number of Hauls
## 2                 150        Seine            3    Number of Hauls
## 3                 150        Seine            3    Number of Hauls
## 4                 150        Seine            5    Number of Hauls
## 5                 150        Seine            3    Number of Hauls
## 6                 150        Seine            3    Number of Hauls
##   Centrarchidae Cyprinidae Catostomidae Ictaluridae Percidae
## 1             1          1            0           0        0
## 2             0          1            0           0        0
## 3             0          1            1           0        0
## 4             1          1            1           0        0
## 5             0          1            1           0        0
## 6             0          1            1           0        0
```

<br>

### Using the fish data

At some sites, no fish were collected despite attempts.
These zero counts for fish are included in the output datasets and are indicated by the `FishCollection` column.

The fish sample by taxa community matrix includes information on both reach length fished (`ReachLengthFished_m`), the sampling method employed (e.g., electrochocking, seining, snorkelling; `SampleMethod`), standardizeand effort values (e.g., minutes of shocking, number of seine hauls, minutes snorkeling; `MethodEffort`), and specific protocol employed (e.g., NRSA small stream, NRSA large stream, etc.; `SampleTypeCode`).
`MethodEffort` and `ReachLengthFished_m` are facets of sampling effort and influence the number of individuals measured in a sample and may be important covariates ([Figure 9](#Figure9)).
However, unlike the macroinvertebrate sampling variables ([Figure 7](#Figure7)), these fish sampling variables vary randomly through time.
There could conceivably be instances in which fish sampling variables are important to consider in analyses given their wide variation and correlation with number of fish within samples.

<br>

<center>

<a id="Figure9"></a>

![**Figure 9**. Associations among sampling variables (minutes spent electroshocking [`MethodEffort`] and area sampled [`ReachLengthFished_m`]), catch per unit effort (CPUE), and time for both EPA and USGS datasets. These associations suggest that users should consider these sampling effort variables. For instance, as (A) `MethodEffort` and (B) `ReachLengthFished_m` increase, the total number of fish decreases. However, unlike the macroinvertebrate sampling variables (compare [Figure 7C-D](#Figure7) with Figure 9C-D), these fish sampling variables randomly vary through time. There could be instances in which fish sampling variables are still important to consider in analyses given their wide variation and correlation with number of fish within samples.](https://github.com/mahonmb/Misc/blob/main/propareaFish.png?raw=TRUE){width="550"}

</center>

<br>

<a id="NLCD"></a>

# Abiotic Dataset: National Land Cover Database

There is one abiotic function that generates land cover data, `getNLCDData()`.
`getNLCDData()` retrieves land cover data from the Multi-Resolution Land Characteristics Consortium's National Land Cover Database (NLCD) for sampling sites at the catchment and watershed scales.
This function directly accesses the EPA StreamCat API ([Hill et al. 2015](https://onlinelibrary.wiley.com/doi/full/10.1111/1752-1688.12372)) to gather NLCD data based on sampling location from NHDPlus COMIDs and collection year.

`getNLCDData()` matches sampling sites to NLCD data in time.
NLCD data are currently available within StreamCat for the following years: 2001, 2004, 2006, 2008, 2011, 2013, 2016, and 2019, with plans to include subsequent years as they become available.
For instances of samples that do not have a match in collection year to a year of NLCD data, samples are matched to the closest year of NLCD data.
For instance, a site sampled in 1995 is matched to 2001 NLCD data.
For samples (e.g. collection year 2005) that fall at the midpoint of two NLCD years (e.g. 2004 and 2006 NLCD data), the function pulls NLCD data from the earlier year (e.g. 2004 NLCD data).

Users can specify whether NLCD data should be extracted at the catchment `Cat` or watershed `Ws` scales.
The catchment includes only land that drains directly to the stream segment of the sampling location, excluding contributions from upstream segments of the watershed.
In contrast, watersheds are larger than catchments and include land that drains directly to the stream segment from the surrounding uplands, plus all upstream contributions from flow-connected stream segments.
See [StreamCat](https://www.epa.gov/national-aquatic-resource-surveys/streamcat-dataset) documentation for more information.

NLCD data can be grouped into five broad categories using `group = TRUE`.
These categories include "water" (grouping of all wetland and open water land covers), "urban" (grouping of all urban land use), "forest" (grouping of deciduous, coniferous, and mixed forests land covers), "open" (grouping of shrub, barren land, grassland, and hay/pasture land covers), and "crop" (cultivated crop land use).


```r
dat = data.frame(SiteNumber = "USGS-05276005",
                 CollectionYear = c(2005, 2007, 2009))

getNLCDData(data = dat,
            scale = "Cat",
            group = FALSE)
```

```
##      SiteNumber CollectionYear PCTURBMD_Cat PCTMXFST_Cat PCTHAY_Cat
## 1 USGS-05276005           2005         0.25         1.02      41.31
## 2 USGS-05276005           2007         0.35         1.02      41.48
## 3 USGS-05276005           2009         0.46         1.02      41.48
##   PCTURBLO_Cat PCTSHRB_Cat PCTURBHI_Cat PCTHBWET_Cat PCTCROP_Cat PCTGRS_Cat
## 1         3.84           0         0.11         2.81       38.56          0
## 2         3.84           0         0.11         2.64       38.56          0
## 3         3.91           0         0.11         2.50       38.56          0
##   PCTOW_Cat PCTBL_Cat PCTCONIF_Cat PCTDECID_Cat PCTURBOP_Cat PCTWDWET_Cat
## 1         0         0            0         0.46         3.20         8.44
## 2         0         0            0         0.46         3.10         8.44
## 3         0         0            0         0.46         2.92         8.59




```

```r
##select 10 random samples from the dataset to get LULC data for
set.seed(1)
Fish_forNLCD = Fish[sample(1:1000,10, replace = FALSE),] %>%
  dplyr::select(SiteNumber, CollectionYear)

getNLCDData(data = Fish_forNLCD,
            scale = "Cat",
            group = TRUE)
```

```
##       SiteNumber CollectionYear PctCrop_Cat PctFst_Cat PctOpn_Cat PctUrb_Cat
## 1  USGS-01072845           2000        0.00      75.35       8.53       5.30
## 2  USGS-05318630           1997       89.00       0.40       0.60       5.29
## 3  USGS-01089743           2000        0.00      55.50       1.16      29.45
## 4  USGS-13010065           1994        0.00      22.46      28.76      13.15
## 5  USGS-05082625           1993       69.39       3.81       2.94       5.51
## 6  USGS-02458150           2001        0.00       8.38       0.67      90.22
## 7  USGS-08050800           1993        0.00      30.26      63.96       4.30
## 8  USGS-01096544           2000        0.44      32.19      19.34      25.82
## 9  USGS-01372200           1995        0.00      56.89      17.54      20.46
## 10 USGS-01144000           1993        0.00      87.58       5.25       6.66
##    PctWater_Cat
## 1         10.81
## 2          4.70
## 3         13.91
## 4         35.62
## 5         18.35
## 6          0.73
## 7          1.50
## 8         22.20
## 9          5.10
## 10         0.50
```

<br>

<a id="TL;DR"></a>

# TL;DR Summary of Benefits, Barriers Addressed, and Caveats from the Getting Started Vignette and Manuscript

The benefits of using `finsyncR` to process and integrate the USGS and EPA datasets:

* The package streamlines the process of acquiring, processing, and integrating fish and macroinvertebrate assemblages from USGS BioData and EPA NRSA ([Table 1](#Table1)).
* Sampling sites cover a large spatial extent with high spatial resolution ([Figure 3](#Figure3)).
*	The 27-year time span of the compiled macroinvertebrate and fish data is relatively long ([Figure 3](#Figure3)).
*	The macroinvertebrate and fish assemblages sampled are taxonomically diverse (Fig. 2 in Manuscript).
*	Sampling methodologies are consistent and comparable across samples (Fig. 7 in Manuscript)
*	The streams and rivers sampled cover a range of human-disturbance levels and types (see [getNLCDData](#NLCD))
*	The approaches to data processing and integrating are flexible: occurrence, standardized abundance, or density community matrices at a variety of taxonomic levels can be generated for fish and macroinvertebrates, samples can be rarefied to generate occurrences, taxonomy can be harmonized with different options, community matrices can be generated according to agency and stream or river sizes (see `getInvertData()` and `getFishData()` in Getting Started Vignette).

The barriers that this package addresses:

*	The spatial sampling design is documented to clarify sampling extent and resolution ([Figure 3](#Figure3)).
*	`finsyncR` processes and integrates datasets across years and federal agencies by harmonizing site and sample variable names ([Figure 1](#Figure1); “Acquiring Data” and “Processing Data across Years and Federal Agencies” in Manuscript)
*	`finsyncR` provides options for accounting for differences in taxonomy between agencies and through time (see “Processing Data across Years and Federal Agencies” and “Accounting for Differences in Taxonomy between Agencies and through Time” in Manuscript)
*	`finsyncR` calculates densities and standardized abundances from field counts of organisms (see “Calculating Densities and Standardized Abundances from Field Counts” in Manuscript)
*	`finsyncR` provides options to account for differences in sampling effort across sampling events (see “Accounting for Differences in Sampling Effort across Sampling Events and Improvements in Taxonomic Identifications through Time” in Manuscript)
*	Changes in the ability to make taxonomic identifications through time for macroinvertebrate is documented across macroinvertebrate orders, and options are provided to account for temporal differences in the ability to make identifications (see “Accounting for Differences in Sampling Effort across Sampling Events and Improvements in Taxonomic Identifications through Time” in Manuscript).

The following caveats and disclaimers should be considered ahead of analyses:

*	The approaches provided in this package are not the same as the approaches used in other USGS or EPA publications or national assessments. Replicating analyses may not produce identical results.
*	The methods developed to join datasets have not been designed with the intent of adding other fish and macroinvertebrate datasets. The approaches could or could not be appropriate for other datasets.
*	Most sites are only sampled once so there is low temporal replication of samples at the site level. Time series analyses at the site level are restricted to a small subset of available sites.
*	Variation in sampling effort and changes in the ability of taxonomists to make identifications through time likely influences detection probabilities of organisms, despite harmonization. These sources of variation could be important to account for in certain instances. Users should consider accounting for the following variables for macorinvertebrates: `PropID`, `AreaSampled_m`, and `Gen_ID_Prop`, and for fish: `ReachLengthFished_m`, `SampleMethod`, and `MethodEffort.`


# Parting words

For metadata on output datasets, see the "Metadata" vignette `vignettes("Metadata", "finsyncR")`.
In addition, users may wish to calculate abundances and raw counts or to rarefy raw counts. This functionality is not inherently provided within the `getInvertData()` function, but code to make these calculations can be found in the "Calculating Abundances, Raw Counts, and Rarefying Raw Counts" vignette `vignettes("BackCalculation", "finsyncR")`.

We anticipate that this package will grow and change in the coming years.
In particular, as the NRSA continues to sample rivers and streams throughout the contiguous US, we intend to incorporate each new round of sampling into this R package when the newest data are made public.
So, the timespan of these data will grow.

We are indebted to the federal, state, and tribal biologists and contractors who planned these surveys, collected the samples in the field, and processed and identified samples.
We thank them for their efforts in building these datasets that we consider a national treasure.
We are especially grateful to Sarah Lehmann, Richard Mitchell, Amanda Nahlik, Dave Peck, and Alan Herlihy at the EPA, and Daren Carlisle, Lindsey Boyle, Kelly Maloney, Taylor Woods, Travis Schmidt, Mike Meador, Scott Grotheer, Robert Zuellig, and Peter Ruhl at the USGS for the intellectual support of this work and the many conversations about the nuances of these data.
Jason Rohr was a mentor for MBM, SLR, DKJ, EAB while portions of the current work were completed.
This work was conducted as part of the Analyses of Contaminant Effects in Freshwater Systems: Synthesizing Abiotic and Biotic Stream Datasets for Long-Term Ecological Research Working Group supported by the John Wesley Powell Center for Analysis and Synthesis, funded by the U.S. Geological Survey.

Of note, the approach provided in this package concerning the way the USEPA National Rivers and Streams Assessment data are treated is not necessarily the same as the approach used in the National Rivers and Streams Assessment national reports.

If you have any questions or any issues with these functions, please post on our Github repository [Github](https://github.com/USEPA/finsyncR/issues) or reach out to Samantha Rumschlag ([rumschlag.samantha\@epa.gov](mailto:rumschlag.samantha@epa.gov){.email}) or Michael Mahon ([mahon.michael\@epa.gov](mailto:mahon.michael@epa.gov){.email}).

Data from USGS BioData were obtained from Pete Ruhl ([pmruhl\@usgs.gov](mailto:pmruhl@usgs.gov){.email}), and data from the National Aquatic Resource Surveys are directly downloaded by the package from the NARS website.

# Data Citations:

U.S. Geological Survey, 2020.
BioData - Aquatic bioassessment data for the Nation: U.S. Geological Survey database, accessed 17 December 2020, at <https://doi.org/10.5066/F77W698B>

U.S. Environmental Protection Agency.
2006.
National Aquatic Resource Surveys.
Wadeable Streams Assessment 2004 (data and metadata files).
Available from U.S.
EPA web page: <https://www.epa.gov/national-aquatic-resource-surveys/data-national-aquatic-resource-surveys>.

U.S. Environmental Protection Agency.
2016.
National Aquatic Resource Surveys.
National Rivers and Streams Assessment 2008-2009 (data and metadata files).
Available from U.S.
EPA web page: <https://www.epa.gov/national-aquatic-resource-surveys/data-national-aquatic-resource-surveys>.

U.S. Environmental Protection Agency.
2020.
National Aquatic Resource Surveys.
National Rivers and Streams Assessment 2013-2014 (data and metadata files).
Available from U.S.
EPA web page: <https://www.epa.gov/national-aquatic-resource-surveys/data-national-aquatic-resource-surveys>.

U.S. Environmental Protection Agency.
2022.
National Aquatic Resource Surveys.
National Rivers and Streams Assessment 2018-2019 (data and metadata files).
Available from U.S.
EPA web page: <https://www.epa.gov/national-aquatic-resource-surveys/data-national-aquatic-resource-surveys>.

<br>

# Appendix

<br> <a id="TableA1"></a> **Table A1.** Table linking genus numbers from Figure 2 to genera names, associated lumped genera group, and the number of samples in which each genus appears. Lumped genera groups account for changes in taxonomy through time. Some genera are found in very few samples, and users could consider dropping rare genera and recreating lumped groups depending on their data needs. The table also provides the lowest taxonomic designation common for the lumped group. This column is the taxonomic designation provided to the lumped group in the output from the `lumpRollUp()` function.

| Genus Number |                Genus | EPA Samples | USGS Samples | Lumped Genera Group                                                                                                                                                     | Lowest Common Taxonomy |
|-------------:|---------------------:|------------:|-------------:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------:|
|            1 |           Acentrella |        1108 |         1269 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|            2 |            Acerpenna |         651 |          283 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|            4 |           Amercaenis |          51 |           38 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|            5 |        Americabaetis |           0 |            4 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|            6 |         Anafroptilum |        2089 |          297 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|            8 |            Apobaetis |          61 |            3 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           11 |            Attenella |         292 |           62 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           12 |               Baetis |        3870 |         3445 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           13 |             Baetisca |         349 |           66 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           14 |            Barbaetis |           1 |            0 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           15 |         Brachycercus |         243 |            3 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           16 |               Caenis |        3611 |         1221 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           17 |          Callibaetis |         758 |          105 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           18 |           Caudatella |         194 |           30 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           19 |         Centroptilum |        2089 |          297 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           21 |              Cinygma |         141 |            2 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           22 |            Cinygmula |         726 |          167 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           23 |               Cloeon |           7 |            0 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           25 |             Dannella |          46 |           55 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           26 |           Dentatella |           3 |            0 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           27 |             Diphetor |         822 |          311 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           28 |             Drunella |        1084 |          472 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           29 |           Ecdyonurus |        1133 |          478 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           31 |              Epeorus |        1073 |          602 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           32 |             Ephemera |         359 |          112 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           33 |          Ephemerella |        1077 |          434 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           34 |         Eurylophella |         625 |           95 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           35 |             Fallceon |         830 |          656 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           40 |           Heptagenia |         253 |          240 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           41 |         Heterocloeon |         252 |          185 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           42 |            Hexagenia |         746 |           49 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           44 |             Ironodes |         162 |           39 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           45 |              Iswaeon |         108 |            5 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           46 |          Labiobaetis |         381 |          295 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           49 |           Leucrocuta |        1133 |          478 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           51 |          Litobrancha |          12 |            0 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           52 |        Maccaffertium |        2039 |         1117 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           53 |            Matriella |          29 |           17 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           58 |                 Nixe |        1133 |          478 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           59 |         Paracloeodes |         449 |          123 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           61 |            Penelomax |           0 |            2 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           66 |            Plauditus |         576 |          499 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           67 |            Procloeon |        2089 |          297 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           68 |         Pseudocloeon |         685 |            0 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           69 |      Raptoheptagenia |           1 |            1 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           70 |          Rhithrogena |         705 |          421 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           71 |           Serratella |         565 |          108 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           72 |            Sparbarus |         158 |           16 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           74 |            Stenacron |         964 |          495 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           75 |            Stenonema |        2039 |         1117 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           76 |           Susperatus |           6 |            1 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           77 |         Teloganopsis |         165 |          132 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           78 |            Timpanoga |         135 |           13 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|           80 |               Tsalia |           0 |            1 | 1,2,4,5,6,8,11,12,13,14,15,16,17,18,19,<br>21,22,23,25,26,27,28,29,31,32,33,34,35,<br>40,41,42,44,45,46,49,51,52,53,58,59,61,<br>66,67,68,69,70,71,72,74,75,76,77,78,80 |          Ephemeroptera |
|            3 |          Allenhyphes |           0 |            5 | 3,10,43,47,79,82                                                                                                                                                        |          Leptohyphidae |
|           10 |             Asioplax |          67 |           58 | 3,10,43,47,79,82                                                                                                                                                        |          Leptohyphidae |
|           43 |      Homoleptohyphes |          12 |           13 | 3,10,43,47,79,82                                                                                                                                                        |          Leptohyphidae |
|           47 |          Leptohyphes |          22 |           17 | 3,10,43,47,79,82                                                                                                                                                        |          Leptohyphidae |
|           79 |        Tricorythodes |        2747 |         1612 | 3,10,43,47,79,82                                                                                                                                                        |          Leptohyphidae |
|           82 |          Vacupernius |          17 |           15 | 3,10,43,47,79,82                                                                                                                                                        |          Leptohyphidae |
|            7 |             Anodonta |           9 |            0 | 7,81                                                                                                                                                                    |              Unioninae |
|           81 |          Utterbackia |           3 |            0 | 7,81                                                                                                                                                                    |              Unioninae |
|            9 |              Armiger |           5 |            2 | 9,37                                                                                                                                                                    |            Planorbidae |
|           37 |             Gyraulus |         663 |          153 | 9,37                                                                                                                                                                    |            Planorbidae |
|           20 |          Choroterpes |         204 |           67 | 20,38,39,48,56,60                                                                                                                                                       |        Leptophlebiidae |
|           38 |         Habrophlebia |          18 |            5 | 20,38,39,48,56,60                                                                                                                                                       |        Leptophlebiidae |
|           39 |      Habrophlebiodes |          19 |            1 | 20,38,39,48,56,60                                                                                                                                                       |        Leptophlebiidae |
|           48 |         Leptophlebia |          59 |            5 | 20,38,39,48,56,60                                                                                                                                                       |        Leptophlebiidae |
|           56 |       Neochoroterpes |          54 |           52 | 20,38,39,48,56,60                                                                                                                                                       |        Leptophlebiidae |
|           60 |     Paraleptophlebia |         922 |          545 | 20,38,39,48,56,60                                                                                                                                                       |        Leptophlebiidae |
|           24 |        Cystobranchus |           1 |            0 | 24,62                                                                                                                                                                   |           Piscicolidae |
|           62 |            Piscicola |           8 |            0 | 24,62                                                                                                                                                                   |           Piscicolidae |
|           30 | Chironomus/Einfeldia |        2813 |          455 | 30,36                                                                                                                                                                   |           Chironominae |
|           36 |       Glyptotendipes |         923 |          403 | 30,36                                                                                                                                                                   |           Chironominae |
|           50 |            Libellula |          56 |            3 | 50,65                                                                                                                                                                   |           Libellulidae |
|           65 |            Plathemis |           6 |            0 | 50,65                                                                                                                                                                   |           Libellulidae |
|           54 |              Menetus |         711 |           52 | 54,55                                                                                                                                                                   |            Planorbidae |
|           55 |         Micromenetus |           0 |          120 | 54,55                                                                                                                                                                   |            Planorbidae |
|           57 |       Neostempellina |         107 |            6 | 57,73                                                                                                                                                                   |           Chironominae |
|           73 |          Stempellina |         847 |           73 | 57,73                                                                                                                                                                   |           Chironominae |
|           63 |          Planorbella |         200 |           69 | 63,64                                                                                                                                                                   |            Planorbidae |
|           64 |           Planorbula |           9 |            0 | 63,64                                                                                                                                                                   |            Planorbidae |
