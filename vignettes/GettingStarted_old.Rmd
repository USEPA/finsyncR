---
title: "Getting Started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  markdown: 
    wrap: sentence
---

# Introduction

We originally set out to harmonize these biomonitoring datasets from the USGS and USEPA during the COVID-19 pandemic, spending countless hours coding from home offices, basements, couches, kitchen tables, etc.
The code within these functions represents many virtual meetings with U.S. federal researchers with the most intimate knowledge of the data as well as sample collection, processing, and identification.
We hope that we have done justice to these data; the organisms that were collected; the countless biologists that collected, processed, and identified them; and the U.S. public that paid for their collection.
From the conversations with those most familiar with these datasets, we believe we have harmonized these datasets in the most appropriate manner, accounting for as many confounding variables as possible.
The `finsyncR` package saves users the time and effort of complex data management, while providing a one-stop tool for generating a unified dataset that contains two aquatic biomonitoring datasets that are unrivaled in their spatio-temporal coverage and consistency in sampling methodologies.
Our ultimate goal for this package is to make these unrivaled data more accessible to researchers across the globe.
The package streamlines the process of retrieving and working with biomonitoring datasets, making it easier for researchers to utilize these data.
We have done our best to ensure a wide-range of uses and standard data types generated by these functions.
We welcome suggests for how to improve accessibility.


```r
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = ""  # Added this line to the standard setup chunk
)

##Read in the finsyncR R package
library(finsyncR)
```

# Biotic Datasets

### Invertebrates

Currently, there are two groups of functions in the `finsyncR` R package.
The first group is the *Biotic Datasets* group of functions: `getInvertData()` and `getFishData()`.
The functions are similar in their parameters, but each has unique aspects that users should be aware of.

Starting with the `getInvertData()` function.
This function retrieves, cleans, and compiles the stream macro-invertebrate datasets collected by the USGS and USEPA.
This function corrects for differences in sample splitting that varied by sampling and identification methods, as well as changes in taxonomy through time.

The parameters in the `getInvertData()` function are `dataType`, `taxonLevel`, `taxonFix`, `agency`, `lifestage`, `rarefy`, `sharedTaxa`, `seed` and `boatableStreams`.
`dataType` refers to whether the site by taxa matrix should contain abundance (`dataType = "abun"`) or presence/absence (coded as 1/0; `dataType = "occur"`) values.

`taxonLevel` refers to the taxonomic resolution (Class, Family, etc.) at which the site by taxa matrix will be generated.
These values must start with a capital letter.
To ensure compatibility among USGS and EPA datasets, as well as to minimize variation among taxonomists, `"Genus"` is the finest taxonomic resolution available.

`taxonFix` provides ways to handle changes in taxonomy across time, especially in instances in which species have been reorganized into new genera.
Across the time span of these datasets, the taxonomy of many species changed.
In cases in which a specimen was identified to species, we were able to update the genus designation from the bench identification to the now used genus names.
In other cases, a given specimen was only identified to genus at the bench, and only some species within the given genus were moved into a new genus.
This scenario prevented us from being confident in the identity of the current genus of the given specimen.
In other cases, a specimen was identified at the bench with multiple species or genera names (e.g., species1/species2 or genus1/genus2).
Some instances of combined genera names were not consistent between EPA and USGS.
Therefore, USGS could contain a specimen identified as genus1/genus2, while EPA included instances of separate identifications of genus1 and genus2.
To ensure consistency between the programs, we renamed all single instances of genus1 and genus2 to genus1/genus2 throughout the combined EPA and USGS dataset.
Here, we provide three options for addressing the taxonomic issues present in the USGS and EPA invertebrate datasets.

`taxonFix` operates on the genera level, so set `taxonFix = "none"` when `taxonLevel` is set to `"Subfamily"` or higher taxonomic resolution.
`taxonFix = "none"` makes no adjustment.
`taxonFix = "none"`, still generate "slash" genera, but, it does not link these genera to larger linked genera (see below).
**We only recommend using this approach when `taxonLevel` is not** `"Genus"`.

`taxonFix = "lump"` prioritizes retaining observations of specimens by giving a unified name (e.g., genus1/genus2/genus3) to a complex of genera that have been linked through changes in taxonomy through time.
With this approach, there is no inflation of the number of genera given that individual genera (e.g., genus1) never appeared outside of the unified genera name (e.g., genus1/genus2/genus3).
Within the combined EPA and USGS datasets, 98 genera exist that are linked through changes in taxonomy through time.
All "non-problematic" genera are retained.
`taxonFix = "lump"` results in 13 "lumped" genera (see Figure 1 below).
Most new "lumped" genera are 2 "old" genera joined.
One complex of genera (within Ephemeroptera) includes 70 "old" genera, and a second complex of Ephemeroptera genera included six individual genera.
`taxonFix = "lump"` was used for analyses in [Rumschlag et al. (2023)](https://doi.org/10.1126/sciadv.adf4896)).

`taxonFix = "remove"` prioritizes accurate identification by dropping observations from problematic genera that do not have species identification.
`taxonFix = "remove"` still prioritizes accurate identifications by dropping all obscure identifications, such that **ALL** slash genera and genera complexes are dropped; this will result in many fewer genera being included in the final dataset, but is the most conservative approach if accuracy in identifications is of high priority.

![**Figure 1.** Visualization of the relationship among linked genera (each number represents an individual genera in the original datasets). Linkages indicate that the taxonomic designation of at least one species from one of the genera pairs was updated to be in the other genera in the pair. Clusters (genera complexes) are formed by sets of these linkages. The largest genera complex represented 70 Ephemeroptera genera.](https://github.com/mahonmb/Misc/blob/main/Clusters.jpg?raw=true){width="275"}

`agency` refers to the agency that collected the datasets, we recommend keeping this set to the default of `c("USGS", "EPA")`, because this will result in the largest dataset, but users should be aware that the sampling design (site selection, not sample methology) from each agency is quite different.
Specifically, sampling locations in the USGS dataset were constrained by region and/or surrounding landuse, but the USGS dataset provides the sampling locations with the longest duration of collection.
Conversely, sampling locations in the EPA datasets are chosen randomly, but are only collected in two-year phases with 4 years between phases.Users should familiarize themselves with the sampling manuals from each of the agencies: [USGS NAWQA](https://pubs.usgs.gov/publication/ofr93406) and [EPA NRSA](https://www.epa.gov/national-aquatic-resource-surveys/manuals-used-national-aquatic-resource-surveys#National%20Rivers%20&%20Streams%20Assessment). Finally, all USGS sampling locations are considered wadeable streams, while EPA samples both wadeable streams and boatable rivers.
As such, `boatableStreams` should only be `TRUE` when `agency` is set to `"EPA"` only, to ensure the highest level comparability/compatibility between the two agency datasets.

`rarefy` refers to whether samples should be rarefied to 300 individuals to obtain species richness values that are not biased based on the number of individuals identified within a sample (See Figure 2 below, taken from [Rumschlag et al. (2023)](https://doi.org/10.1126/sciadv.adf4896)).
When `rarefy = TRUE`, only samples with 300+ individuals identified will be retained.
Thus, \~17% of samples will be removed, as they have \<300 individuals sampled.
We set the rarefaction threshold at 300, because 1) with every 50 individuals identified, \~1 genera are added to the sample and 2) 82.8% of samples have at least 300 individuals identified.
Thus, lowering the threshold to 200 individuals removed \~2 genera per sample, but only added an additional 7.3% of samples included (90.1% from 82.8%).
Similarly, increasing the threshold to 400 individuals added \~2 genera per sample, but reduced samples to 30.3% of all samples.

![**Figure 2.** Visualization of the relationship between mean number of genera gains, the proportion of samples with at least n number of organisms identified, and the number of organisms identified er sample, justifying the use of 300 as the rarefication threshold.](https://github.com/mahonmb/Misc/blob/main/SciAdvFigS3.jpg?raw=true){width="275"}

Because target specimen (i.e., number of specimen to be identified at the bench) varies across programs, agencies, time, and space, it is necessary to use `rarefy = TRUE` when calculating diversity metrics from these datasets, in order to better account for differences among samples driven by differences in the raw number of individuals identified within a sample.
Use `seed =` and provide an integer to get consistent output of community data (passed to `set.seed()` internally).
`rarefy = TRUE` can be used when wanting occurrence data (presence/absence) OR proportional data (each taxon represents a certain percent of a sample).
To generate density values, use `dataType = "abun"` with `rarefy = FALSE`.

`lifestage` refers to whether the generated site by taxa matrix should include lifestage information for each of the taxa/individuals collected.
If `lifestage = TRUE`, the generated matrix will have separate columns for the various lifestages collected for each taxa.
Lifestage is only noted within the USGS samples, not within the EPA datasets; so, `lifestage = TRUE` will only provide lifestage information for USGS samples.

`sharedTaxa` refers to whether the resulting dataset should only contain taxa that are found in both agency datasets.
Set `sharedTaxa = FALSE` if only using data from one agency.
We recommend using `sharedTaxa = TRUE` when comparing across agencies, so that species pools are consistent.


```r

##This code will generate density estimates at the family level for all samples
##in the NAWQA database. Lifestage information will be ignored.

Inverts <- getInvertData(dataType = "abun",
                         taxonLevel = "Genus",
                         agency = "USGS",
                         lifestage = FALSE,
                         rarefy = FALSE,
                         seed = 1,
                         boatableStreams = FALSE)

head(Inverts)[,1:35]
#>   Agency ProjectLabel ProjectAssignedSampleLabel      NAWQA.SMCOD NAWQAStudyUnitCode CollectionDate CollectionYear CollectionMonth
#> 1   USGS  WHMI BioTDB                            MIAM0799IRM0004*               WHMI     1999-07-13           1999               7
#> 2   USGS  WHMI BioTDB                            MIAM0799IRM0016*               WHMI     1999-07-14           1999               7
#> 3   USGS  WHMI BioTDB                            MIAM0799IRM0014*               WHMI     1999-07-15           1999               7
#> 4   USGS  WHMI BioTDB                            MIAM0799IRM0008*               WHMI     1999-07-07           1999               7
#> 5   USGS  WHMI BioTDB                            MIAM0799IRM0010*               WHMI     1999-07-06           1999               7
#> 6   USGS  WHMI BioTDB                            MIAM0799IRM0012*               WHMI     1999-07-13           1999               7
#>   CollectionDayOfYear SiteVisitSampleNumber           SiteNumber                                          SiteName                 StudyReachName
#> 1                 194                 25076 USGS-393259085101200                 Whitewater River nr. Nulltown, IN 393259085101200-A-NAWQA-BioTDB
#> 2                 195                 25078        USGS-03245500                  Little Miami River at Milford OH        03245500-A-NAWQA-BioTDB
#> 3                 196                 25080        USGS-03246400 East Fork Little Miami River near Williamsburg OH        03246400-A-NAWQA-BioTDB
#> 4                 188                 25082 USGS-395534084091400                  Great Miami R. nr. Tipp City, OH 395534084091400-A-NAWQA-BioTDB
#> 5                 187                 25084 USGS-395650083504400              Mad R. nr Hwy. 41 nr Springfield, OH 395650083504400-A-NAWQA-BioTDB
#> 6                 194                 25126 USGS-392246084340100              Great Miami River below Hamilton, OH 392246084340100-A-NAWQA-BioTDB
#>   SiteTypeName Latitude_dd Longitude_dd CoordinateDatum SampleTypeCode                   IdentificationEntity GeomorphicChannelUnit FieldSplitRatio
#> 1       Stream    39.54977    -85.16996           NAD27           IRTH USGS National Water Quality Laboratory                Riffle               1
#> 2       Stream    39.17145    -84.29799           NAD27           IRTH USGS National Water Quality Laboratory                Riffle               1
#> 3       Stream    39.05895    -84.05132           NAD27           IRTH USGS National Water Quality Laboratory                Riffle               1
#> 4       Stream    39.92617    -84.15383           NAD27           IRTH USGS National Water Quality Laboratory                Riffle               1
#> 5       Stream    39.94728    -83.84549           NAD27           IRTH USGS National Water Quality Laboratory                Riffle               1
#> 6       Stream    39.37950    -84.56689           NAD27           IRTH USGS National Water Quality Laboratory                Riffle               1
#>   LabSubsamplingRatio PropID AreaSampTot_m2 WettedWidth    COMID StreamOrder Gen_ID_Prop
#> 1              0.0170 0.0170           1.25          NA 19645438           1   0.8838527
#> 2              0.0347 0.0347           1.25          NA 25243939           5   0.8655914
#> 3              0.0397 0.0397           1.25          NA  3936150           4   0.8084416
#> 4              0.0149 0.0149           1.25          NA 19645438           1   0.7481297
#> 5              0.0298 0.0298           1.25          NA 19645438           1   0.7476923
#> 6              0.0113 0.0113           1.25          NA       NA          NA   0.8468208
#>   Acentrella.Acerpenna.Amercaenis.Americabaetis.Anafroptilum.Anthopotamus.Apobaetis.Attenella.Baetis.Baetisca.Barbaetis.Brachycercus.Caenis.Callibaetis.Campsurus.Caudatella.Centroptilum.Choroterpes.Cinygma.Cinygmula.Cloe.Cloeon.Dannella.Dentatella.Diph ...
#> 1                                                                                                                                                                                                                                                         3104.8
#> 2                                                                                                                                                                                                                                                         1497.6
#> 3                                                                                                                                                                                                                                                         2217.6
#> 4                                                                                                                                                                                                                                                         2419.2
#> 5                                                                                                                                                                                                                                                         1263.2
#> 6                                                                                                                                                                                                                                                         1058.4
#>   Antocha Cardiocladius.Eukiefferiella.Tvetenia Ceratopsyche.Hydropsyche Cheumatopsyche Hydroptila Krenopsectra.Micropsectra.Tanytarsus
#> 1    94.4                                1176.0                   7291.2         1693.6      188.0                                 94.4
#> 2     0.0                                  68.8                   1659.2         2903.2      115.2                                  0.0
#> 3     0.0                                   0.0                     80.0         1028.0        0.0                                 60.8
#> 4    53.6                                 107.2                   3332.8         4192.8       53.6                                  0.0
#> 5     0.0                                 994.4                   2124.0          161.6        0.0                                 53.6
#> 6     0.0                                   0.0                   1058.4         4656.8      211.2                                  0.0
```

### Using the invertebrate data

The resulting invertebrate data will include covariates that are important to clarifying patterns within these data.
The covariates of particular interest to users that will use density data are proportion of sample identified (`propID`) and area sampled (`AreaSampledTotal_m`).
Proportion of the sample identified (`propID`) represented the proportion of the sample collected in the field that was actually identified at the lab bench.
For the USGS dataset, this incorporates both "field split ratio" (proportion of the sample that was brought into the lab for specimen identification) and the "lab subsampling ratio" (proportion of grids used to identify invertebrates at the lab bench).
While for the EPA datasets, this is just the "lab subsampling ratio" the proportion of grids used to identify invertebrates at the lab bench.
See Figure 3 below for visual representation of the `propID` variable.
When conducting density analyses, it is important to use `propID` as a covariate when possible, as `propID` varies across space and time, as well as between agencies.

![**Figure 3**. Calculation of proportion sample identified for USGS and EPA samples. Field split ratio is the proportion of the field collected sample that was brought into the lab to be identified; note that only the USGS data included field split ratios. Lab subsampling ratio is the proportion of grids used to identify invertebrates at the lab bench.](https://github.com/mahonmb/Misc/blob/main/InvertAbun.jpg?raw=true){width="352"}

OTHER STUFF ABOUT USING THE INVERT DATA????
- taxonomic improvements through time?

### Fish

The second function in the *Biotic Datasets* group of functions is `getFishData()`.
This function retrieves, cleans, and compiles the stream fish datasets from the USGS and USEPA.
Because there were differences in how fish were sampled (e.g., netting, electroshocking, and snorkeling), sampling methodologies are retained, as it is difficult to combine samples from these disparate methods.
However, we provide for the standardization of abundances within sample methods (individuals per unit effort per meter of stream sampled), as well as an option for multigear mean standardization (see below).

Fish species names have been updated, such that species with current and synonymous names in the datasets are combined as the current scientific name.

The parameters in the `getFishData()` function are `dataType`, `taxonLevel`, `agency`, `standardize`, `hybrids`, and `boatableStreams`.
`dataType` refers to whether the site by taxa matrix should contain abundance (`dataType = "abun"`) or presence/absence (coded as 1/0; `dataType = "occur"`) values.

`taxonLevel` refers to the taxonomic resolution (Family, Genus, Species) at which the site by taxa matrix will be generated.
These values must start with a capital letter.
The function can generate taxa by sample matrices at Family, Genus, or Species resolution.

`agency`refers to the agency that collected the datasets, we recommend keeping this set to the default of `c("USGS", "EPA")`, because this will result in the largest dataset.
Users should be aware that the sampling schemes are different between agencies.
Specifically, sampling locations in the USGS dataset were constrained by region and/or surrounding landuse, but the USGS dataset provides the sampling locations with the longest duration of collection.
Conversely, sampling locations in the EPA datasets are chosen randomly, but are only collected in two-year phases with 4 years between phases.

`standardize` refers to whether the abundance values in the site by taxa matrix should be standardized by unit effort (individuals per unit effort per meter sampled).
Specifically, `standardize = "CPUE"` results in abundances that are divided by the seconds shocked, number of seine hauls, etc.
These values are then divided by the stream length sampled.
When `standardize = "MGMS"`, abundances are standardized as in `CPUE`, then mean total CPUE (summation of CPUEs for all taxa at each site for each collection date) is calculated for each sampling method.
Then each CPUE value is divided by the mean total CPUE by the mean total CPUE for their respective sampling methods.
`MGMS` will have only one row for each time-location because the function standardizes by sampling method in addition to area sampled, meaning that the resulting abundance values will be summed between sampling methods for each time-location sampling event.
See the supplement of [Gibson-Reinemer et al. (2017)](https://doi.org/10.1139/cjfas-2016-0003) for an example of MGMS computation.
It is highly recommended that users set `standardize` to either "`CPUE"` or `"MGMS"` if they are interested in comparing abundance values across sites.
Note: \~35 samples lacked the required standardization information.
Therefore, if you are interested in occurrence (presence/absence) data only, set `standardize = "none"` and `dataType = "occur"`.
Users should be aware that setting `standardize = "none"` will result in a larger dataset with additional samples/sites than when `standardize = "CPUE"` or `standardize = "MGMS"`.

`hybrid` refers to whether the output dataset should include fish identified as hybrids between two species.
From conversations with fish experts, we recommend keeping this set to the default of `hybrid = FALSE`, as hybrids are notoriously difficult to identify and may not equate to unique species.

Finally, `boatableStreams` refers to whether boatable streams should be included in the EPA dataset.
Since all USGS sites are coded as "wadeable", `boatableStreams` should only be `TRUE` when `agency` is set to `"EPA"` only to ensure the highest level comparability/compatibility between the two agency datasets.


```r

##This code will generate density estimates at the Family level for all samples
##in the NAWQA database.

Fish <- getFishData(dataType = "occur",
                    taxonLevel = "Family",
                    agency = c("USGS", "EPA"),
                    standardize = "none",
                    hybrids = FALSE,
                    boatableStreams = FALSE)

head(Fish)[,1:35]
#>   ProjectLabel ProjectAssignedSampleLabel NAWQA.SMCOD
#> 1     MMSD Eco                                       
#> 2     MMSD Eco                                       
#> 3     MMSD Eco                                       
#> 4     MMSD Eco           WMIC0907FSH0004A            
#> 5     MMSD Eco                                       
#> 6     MMSD Eco                                       
#>   NAWQAStudyUnitCode CollectionDate StartTime
#> 1                        2007-09-10     10:20
#> 2                        2007-09-05     10:52
#> 3                        2007-09-05     07:40
#> 4                        2007-09-04     14:10
#> 5                        2007-09-12     13:00
#> 6                        2007-09-07     08:55
#>                     TimeDatum CollectionYear CollectionMonth
#> 1 CDT - Central Daylight Time           2007               9
#> 2 CDT - Central Daylight Time           2007               9
#> 3 CDT - Central Daylight Time           2007               9
#> 4 CDT - Central Daylight Time           2007               9
#> 5 CDT - Central Daylight Time           2007               9
#> 6 CDT - Central Daylight Time           2007               9
#>   CollectionDayOfYear SiteVisitSampleNumber    SiteNumber Agency
#> 1                 253                     1 USGS-04086600   USGS
#> 2                 248                     1 USGS-04087030   USGS
#> 3                 248                     1 USGS-04087070   USGS
#> 4                 247                     4 USGS-04087088   USGS
#> 5                 255                     1 USGS-04087119   USGS
#> 6                 250                     1 USGS-04087204   USGS
#>                                  SiteName      StudyReachName
#> 1      MILWAUKEE RIVER NEAR CEDARBURG, WI 04086600-A-MMSD Eco
#> 2  MENOMONEE RIVER AT MENOMONEE FALLS, WI 04087030-A-MMSD Eco
#> 3 LITTLE MENOMONEE RIVER AT MILWAUKEE, WI 04087070-A-MMSD Eco
#> 4        UNDERWOOD CREEK AT WAUWATOSA, WI 04087088-A-MMSD Eco
#> 5            HONEY CREEK AT WAUWATOSA, WI 04087119-A-MMSD Eco
#> 6        OAK CREEK AT SOUTH MILWAUKEE, WI 04087204-A-MMSD Eco
#>   SiteTypeName Latitude_dd Longitude_dd CoordinateDatum     HUCCode
#> 1       Stream    43.28028    -87.94250           NAD83 40400030604
#> 2       Stream    43.17278    -88.10389           NAD83 40400030401
#> 3       Stream    43.12361    -88.04361           NAD83 40400030402
#> 4       Stream    43.05472    -88.04611           NAD83 40400030404
#> 5       Stream    43.04383    -88.00511           NAD83 40400030405
#> 6       Stream    42.92500    -87.87000           NAD83 40400020102
#>   DrainageArea_mi2 MethodBasic ReachLengthFished_m StandardMethod
#> 1            607.0       Seine                 300              3
#> 2             34.7       Seine                 150              3
#> 3             19.7       Seine                 150              3
#> 4             18.1       Seine                 150              5
#> 5             10.3       Seine                 150              3
#> 6             25.0       Seine                 150              3
#>    FISH_PROTOCOL Methods SAMPLED_FISH    COMID StreamOrder
#> 1 Large Wadeable   Seine         <NA> 19645438           1
#> 2 Small Wadeable   Seine         <NA> 19645438           1
#> 3 Small Wadeable   Seine         <NA> 19645438           1
#> 4 Small Wadeable   Seine         <NA> 19645438           1
#> 5 Small Wadeable   Seine         <NA> 19645438           1
#> 6 Small Wadeable   Seine         <NA> 19645438           1
#>   Centrarchidae Cyprinidae Catostomidae Ictaluridae Percidae Esocidae
#> 1             1          1            0           0        0        0
#> 2             0          1            0           0        0        0
#> 3             0          1            1           0        0        0
#> 4             1          1            1           0        0        0
#> 5             0          1            1           0        0        0
#> 6             0          1            1           0        0        0
```

### Using the fish data

There are several instances within the fish data in which field biologists did not collect any fish.
These samples are indicated by the "No.Fish" column.
Users should avoid this column when calculating diversity metrics or when conducting multivariate analyses.
The resulting fish data will include information on both reach length fished (`ReachLengthFished_m`), the sampling method employed (e.g., electrochocking, seining, snorkelling; `MethodBasic`), standardizeand effort values (e.g., minutes of shocking, number of seine hauls, minutes snorkeling; `StandardMethod`), and specific protocol employed (e.g., NRSA small stream, NRSA large stream, etc.; `FISH_PROTOCOL`).
Users should note that conductivity can influence efficiency of electroshocking (e.g., [Lyon et al. 2014](https://cdnsciencepub.com/doi/10.1139/cjfas-2013-0287)), so, conductivity may be an important covariate to account for when using the electroshocking data, as conductivity likely has large ranges among sites within these datasets.

# NLCD Land use/Land cover Data

Another function in the `finsyncR` package is `getNLCDData()`, which provides access to catchment-and watershed-level NLCD land use/land cover datasets.
Land-use/land-cover data is extracted from the USGS National Land Cover Database (NLCD) and was generated from StreamCat ([Hill et al. 2015](https://onlinelibrary.wiley.com/doi/full/10.1111/1752-1688.12372)).
This function pulls from internally stored data, rather than pinging the StreamCat database, in an effort to speed up data access.
LULC data are available in the following years: 2001, 2004, 2006, 2008, 2011, 2013, 2016, and 2019.
For instances of years in the input data that are not exact year matches from this list, years are temporally matched to the closest year with LULC data (e.g. a site sampled in 1995 will have LULC data from 2001).
Note that for samples that fall at the midpoint of two NLCD years (e.g. 2005), the function defaults to the earlier year (e.g. a site sampled in 2005 will have LULC data from 2004).

Data can be extracted at the catchment `Cat` or watershed `Ws` scales.
Watershed is larger than catchment, and includes land that drains downstream of the sampling location.
Catchment only includes land that is upstream of the sampling location.
See [StreamCat](https://www.epa.gov/national-aquatic-resource-surveys/streamcat-dataset) documentation for more information.

LULC data can be grouped `group = TRUE` into five broad categories.
These categories include "water" (grouping of all wetland and open water land covers), "urban" (grouping of all urban land use), "forest" (grouping of deciduous, coniferous, and mixed forests land covers), "open" (grouping of shrub, barren land, grassland, and hay/pasture land covers), and "crop" (no grouping, just the crop land use).


```r
dat = data.frame(SiteNumber = "USGS-05276005",
                 CollectionYear = c(2005, 2007, 2009))

getNLCDData(data = dat,
            scale = "Cat",
            group = FALSE)
#>      SiteNumber CollectionYear PCTURBMD_Cat PCTMXFST_Cat PCTHAY_Cat
#> 1 USGS-05276005           2005         0.16         7.63      26.51
#> 2 USGS-05276005           2007         0.69         7.63      24.89
#> 3 USGS-05276005           2009         0.69         7.63      24.89
#>   PCTURBLO_Cat PCTSHRB_Cat PCTURBHI_Cat PCTHBWET_Cat PCTCROP_Cat
#> 1         0.94        2.54         0.05         0.07        2.85
#> 2         1.30        3.47         0.23         0.16        3.04
#> 3         1.30        3.86         0.23         0.12        3.04
#>   PCTGRS_Cat PCTOW_Cat PCTBL_Cat PCTCONIF_Cat PCTDECID_Cat
#> 1       1.89      0.60         0         7.65        43.02
#> 2       0.73      0.53         0         7.65        42.86
#> 3       1.01      0.55         0         7.65        42.18
#>   PCTURBOP_Cat PCTWDWET_Cat
#> 1         6.05         0.04
#> 2         6.81         0.00
#> 3         6.81         0.02
```

## Parting words

For metadata on output datasets, check out the "Metadata" vignette `vignettes("Metadata", "finsyncR")`.

R packages are not static and require regular tweaking and maintenance, so regular updates will occur.
Furthermore, the EPA NRSA program continues to sample rivers and streams throughout the contiguous US and we intend to incorporate each new round of NRSA sampling into this R package as soon as the newest data are made public.
So, the \~30 year time-span of this dataset will only grow as the EPA continues to conduct sampling.

We are completely indebted to the countless biologists who collected the invertebrate and fish samples in the field, who processed and identified samples, and who oversee these collection programs and thank them for their efforts.

If you have any questions or any issues with these functions, please post on our Github repository [Github]() or reach out to Samantha Rumschlag ([rumschlag.samantha\@epa.gov](mailto:rumschlag.samantha@epa.gov){.email}) or Michael Mahon ([m](mailto:mmahon4@nd.edu){.email}[mahon.michael\@epa.gov](mailto:mahon.michael@epa.gov){.email}).
